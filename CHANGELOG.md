# 更新日志

## [未发布] - 2025-11-06

### 重要变更 🔄 (最新)

- **PnL追踪系统重构**: 全面增强交易数据追踪和分析能力
  - **交易统计快照** (`trade_snapshots`): 每次执行交易后自动记录统计数据（已实现盈亏、手续费、净盈亏等）
  - **历史成交记录** (`historical_trades`): 自动从Binance API获取并保存完整的原始交易数据
    - 保留所有Binance API返回的字段
    - 价格和数量使用字符串格式保持精度
    - 自动添加可读时间字段
  - **数据查看器** (`pnl_viewer.py`): 支持多种查看和分析模式
    - 查看每日盈亏摘要
    - 查看交易统计快照
    - 查看历史成交记录（支持新旧两种格式）
    - 分析快照变化趋势
  - **历史数据获取器** (`fetch_historical_trades.py`): **新增工具**
    - 独立获取指定日期的历史成交数据
    - 支持批量获取多日数据
    - 数据单独保存在 `pnl/historical_trades/` 目录
    - 不包含PnL统计，专注于交易记录
  - **文档更新**: 完整的使用指南和重构文档
  - 详见: `docs/pnl-tracker-refactoring.md` 和 `pnl/README.md`

---

## [之前更新] - 2025-11-04

### 重要变更 🔄 (最新)

- **AI响应格式变更**: 从对象格式改为数组格式
  - 系统提示词要求AI返回JSON数组 `[{...}, {...}]` 而不是对象 `{"BTC": {...}}`
  - 优点: 结构更清晰，符合标准JSON数组规范，易于遍历和扩展
  - `ai_decision.py` 中的 `parse_and_validate_decision` 和 `make_decisions_multi` 已更新以支持数组格式

---

## [之前更新] - 2025-11-04

### 新增 ✨

- **nof1 系统提示词**: 基于 nof1.ai Alpha Arena 逆向工程的专业级系统提示词
  - 文件: `prompt-template/nof1_system_prompt_cn.md`
  - 包含完整的交易环境规范、风险管理协议和技术指标解读
  - 针对 Deepseek 模型的特定优化指令
  - 支持动态模型名称替换 `[MODEL_NAME]` → 实际配置的模型

- **提示词配置管理**: 新增 `PromptConfig` 类统一管理提示词路径
  - 支持通过环境变量自定义提示词文件
  - 配置验证功能
  - 简化的路径管理（移除多余的 fallback）

- **优化文档**: 
  - `docs/prompt-optimization-guide.md`: 完整的提示词优化指南
  - 包含设计理念、使用方法、最佳实践
  - 更新 README.md，添加提示词系统说明

### 改进 🔧

- **PromptManager 重构**:
  - 移除硬编码的默认系统提示词逻辑
  - 统一在 Config 中管理所有提示词路径
  - 自动替换模型名称占位符
  - 简化错误处理，强制配置正确性
  - 改进日志输出，显示模型名称

- **Config 优化**:
  - 添加提示词配置部分的打印摘要
  - 显示实际使用的提示词文件名
  - 移除 fallback 机制，简化配置逻辑

- **README.md 更新**:
  - 添加专业提示词工程章节
  - 更新自定义提示词方法说明
  - 添加提示词优化指南链接

### 技术细节 📝

- 系统提示词长度: ~4500 字符
- 包含的核心模块:
  - 角色与身份定义
  - 交易环境规范
  - 行动空间定义
  - 仓位管理约束
  - 风险管理协议
  - 数据解读指南
  - 交易哲学与最佳实践
  - Deepseek 模型优化指令

### 配置变更 ⚙️

新增环境变量支持：
```bash
SYSTEM_PROMPT_FILE=/path/to/system_prompt.md
USER_PROMPT_TEMPLATE_FILE=/path/to/user_prompt.md
```

### 测试 ✅

- 配置验证测试: 通过 ✓
- PromptManager 初始化测试: 通过 ✓
- 系统提示词加载测试: 通过 ✓
- 用户提示词模板加载测试: 通过 ✓

---

## [0.1.1] - 之前的版本

（略）

